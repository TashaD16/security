# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º

## ‚úÖ Java Code Conventions

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:
- ‚úÖ **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: –ö–ª–∞—Å—Å—ã –≤ PascalCase, –º–µ—Ç–æ–¥—ã –≤ camelCase, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ UPPER_SNAKE_CASE
- ‚úÖ **–ü–∞–∫–µ—Ç—ã**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ –ª–æ–≥–∏—á–Ω–∞—è –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è
- ‚úÖ **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö–æ–¥ —Ö–æ—Ä–æ—à–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω, –æ—Ç—Å—Ç—É–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ
- ‚úÖ **JavaDoc**: –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–∞**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (private, public, final –≥–¥–µ –Ω—É–∂–Ω–æ)

### –ó–∞–º–µ—á–∞–Ω–∏—è:
- ‚ö†Ô∏è –ù–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ª–∏—Ç–µ—Ä–∞–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "READ_DECLARATION", "ADMIN")

## ‚ùå DRY (Don't Repeat Yourself)

### –ù–∞—Ä—É—à–µ–Ω–∏—è:

#### 1. **CustomAuthorizationManager** - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –º–µ—Ç–æ–¥–∞—Ö check*

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥—ã `checkReadDeclaration`, `checkWriteDeclaration`, `checkReadWare`, `checkWriteWare` –∏–º–µ—é—Ç –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```java
// –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –º–µ—Ç–æ–¥–µ:
ServerWebExchange exchange = context.getExchange();
String path = exchange.getRequest().getPath().value();
String declarationId = extractPathVariable(path, "declarationId");
logger.info("Checking ... access for ...: {} by user: {}", ...);
if (authentication == null || !authentication.isAuthenticated()) {
    return Mono.just(new AuthorizationDecision(false));
}
boolean hasAccess = authentication.getAuthorities().stream()
    .anyMatch(a -> a.getAuthority().equals("...") || 
                 a.getAuthority().equals("ADMIN"));
```

**–†–µ—à–µ–Ω–∏–µ**: –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- `checkAuthentication(Authentication)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `checkAuthority(Authentication, String)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ authority
- `extractPathVariable(AuthorizationContext, String)` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

#### 2. **EndpointSecurityScanner.extractAuthorizationMethod()** - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ if-–±–ª–æ–∫–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è if-–±–ª–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏:

```java
if (AnnotatedElementUtils.hasAnnotation(method, RequiresReadDeclaration.class)) {
    return (authenticationMono, context) -> authenticationMono
        .flatMap(authentication -> authorizationManager.checkReadDeclaration(...));
}
// –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 7 —Ä–∞–∑ —Å —Ä–∞–∑–Ω—ã–º–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Map –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –Ω–∞ –º–µ—Ç–æ–¥—ã –∏–ª–∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é.

#### 3. **checkDeclarationOwnership** –∏ **checkWareOwnership** - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: –û–±–∞ –º–µ—Ç–æ–¥–∞ –∏–º–µ—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É, –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–º–µ–Ω–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

**–†–µ—à–µ–Ω–∏–µ**: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω –º–µ—Ç–æ–¥ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º —Ç–∏–ø–∞ —Ä–µ—Å—É—Ä—Å–∞.

## ‚ö†Ô∏è SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã

### Single Responsibility Principle (SRP)

#### ‚úÖ –•–æ—Ä–æ—à–æ:
- `SecurityConfig` - –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `EndpointSecurityScanner` - –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- `EndpointSecurityScanResult` - –ø—Ä–æ—Å—Ç–æ–π DTO, —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ

#### ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏—è:

**CustomAuthorizationManager** - –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç authorities
3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –ø—É—Ç–∏
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
5. –õ–æ–≥–∏—Ä—É–µ—Ç

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞:
- `AuthenticationChecker` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `AuthorityChecker` - –ø—Ä–æ–≤–µ—Ä–∫–∞ authorities
- `ResourceOwnershipService` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è
- `PathVariableExtractor` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### Open/Closed Principle (OCP)

#### ‚úÖ –•–æ—Ä–æ—à–æ:
- –°–∏—Å—Ç–µ–º–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ä–∞—Å—à–∏—Ä—è–µ–º–∞ - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
- `EndpointSecurityScanner` –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
- –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å `extractAuthorizationMethod()` (–¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π if)
- –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ check* –º–µ—Ç–æ–¥–∞ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å `CustomAuthorizationManager`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é (Strategy pattern) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

### Liskov Substitution Principle (LSP)

‚úÖ **–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ** - –Ω–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤.

### Interface Segregation Principle (ISP)

‚úÖ **–•–æ—Ä–æ—à–æ** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã Spring Security.

### Dependency Inversion Principle (DIP)

‚úÖ **–•–æ—Ä–æ—à–æ**:
- `SecurityConfig` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (ApplicationContext, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã Spring)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è dependency injection —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

## ‚ö†Ô∏è KISS (Keep It Simple, Stupid)

### ‚úÖ –•–æ—Ä–æ—à–æ:
- –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤
- –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –º–µ—Ç–æ–¥–æ–≤
- –õ–æ–≥–∏–∫–∞ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞

### ‚ö†Ô∏è –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ:
- `EndpointSecurityScanner` - —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π classpath fallback
- `extractAuthorizationMethod()` - –¥–ª–∏–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ if-–æ–≤

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ü—Ä–∏–Ω—Ü–∏–ø | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------|--------|-------------|
| Java Code Conventions | ‚úÖ 8/10 | –•–æ—Ä–æ—à–æ, –Ω–æ –Ω—É–∂–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã |
| DRY | ‚ùå 5/10 | –ú–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ check* –º–µ—Ç–æ–¥–∞—Ö |
| SOLID (SRP) | ‚ö†Ô∏è 6/10 | CustomAuthorizationManager –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ |
| SOLID (OCP) | ‚ö†Ô∏è 6/10 | –î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –∫–æ–¥ |
| SOLID (LSP) | ‚úÖ N/A | –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ |
| SOLID (ISP) | ‚úÖ 9/10 | –•–æ—Ä–æ—à–æ |
| SOLID (DIP) | ‚úÖ 9/10 | –•–æ—Ä–æ—à–æ |
| KISS | ‚ö†Ô∏è 7/10 | –í —Ü–µ–ª–æ–º –ø—Ä–æ—Å—Ç–æ, –Ω–æ –µ—Å—Ç—å —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è |

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):

1. **–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CustomAuthorizationManager**:
   ```java
   private Mono<AuthorizationDecision> checkAccess(
       Authentication authentication,
       AuthorizationContext context,
       String authority,
       String pathVariableName,
       Function<String, Boolean> ownershipChecker) {
       // –û–±—â–∞—è –ª–æ–≥–∏–∫–∞
   }
   ```

2. **–í—ã–Ω–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã**:
   ```java
   private static final String AUTHORITY_ADMIN = "ADMIN";
   private static final String AUTHORITY_READ_DECLARATION = "READ_DECLARATION";
   // –∏ —Ç.–¥.
   ```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):

3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ extractAuthorizationMethod()**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Map<Class<? extends Annotation>, Function<...>>
   - –ò–ª–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é-–º–µ—Ç—É–¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–∞–º–∏—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö

4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ CustomAuthorizationManager**:
   - –í—ã–¥–µ–ª–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è, authority –∏ —Ç.–¥.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ):

5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
6. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
7. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
